<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="C++ Native Functions: com.ibm.streamsx.lock.distributed"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_functions"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>C++ Native Functions: com.ibm.streamsx.lock.distributed</title>
</head>
<body id="spldoc_functions">


<h1 class="title topictitle1">C++ Native Functions: <tt class="ph tt">com.ibm.streamsx.lock.distributed</tt></h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">Streams DPS Toolkit</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.dps.html">com.ibm.streamsx.dps 3.3.0</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.lock.distributed.html">com.ibm.streamsx.lock.distributed</a> &gt; C++ Native Functions</p>

</div>

<div class="section">
This page documents native functions that can be invoked from SPL, including the SPL interfaces that can be used to invoke each of the native functions.
</div>

<div class="section">
<p class="p splhead-1"><strong class="ph b"><a class="xref" href="../references/FunctionModel.html#spldoc_reference_function_model__functionset__functions">Functions</a></strong></p>
<dl class="dl" compact="compact">
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlAcquireLock.uint64.float64.float64.uint64"><tt class="ph tt">      public stateful void dlAcquireLock(uint64 lock, float64 leaseTime, float64 maxWaitTimeToAcquireLock, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p">Acquire lock, with an explicit lease time in seconds and a maximum time to wait to acquire the lock.  This overloaded function can be used to acquire a given distributed lock id.  This function has two advantages over the other <a class="xref" href="fc$com.ibm.streamsx.lock.distributed.html#spldoc_functions__dlAcquireLock.uint64.uint64">dlAcquireLock</a> function.   First of all, callers can pass a fixed lease time for the lock, indicating that the lock will be needed at most for a specified period before which the caller will relinquish this lock.   In addition, the caller can also specify how long the caller is willing to wait to acquire the lock.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">lock</tt></dt>

             <dd class="dd">

<p class="p">the id of the lock to acquire, must have been previously created. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">leaseTime</tt></dt>

             <dd class="dd">

<p class="p">the length of time, in seconds, for which the lock is needed. Must be greater than 0. If the lock is not released after the requested lease time due to a program crash or a programmatic error, the lock will be automatically released and made available for others to acquire. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">maxWaitTimeToAcquireLock</tt></dt>

             <dd class="dd">

<p class="p">Maximum time to wait to acquire the lock, in seconds. If the lock acquisition is not done within the specified max wait time, this function will exit with an error instead of spin looping forever. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">a mutable variable to receive a non-zero error code in the event of a problem acquiring the lock.  Will be set to '0' on success.
</p>

             </dd>

           
         </dl>

       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlAcquireLock.uint64.uint64"><tt class="ph tt">      public stateful void dlAcquireLock(uint64 lock, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p"> This function can be called to acquire a distributed lock. Acquiring a lock before performing a write/delete operation into a data store that is shared by multiple applications is a good way to ensure safe access of the shared resource.  This function can be used to acquire such a lock before in order to gain exclusive access for a shared resource. Locks acquired through this function will be owned until the lock is released via <a class="xref" href="fc$com.ibm.streamsx.lock.distributed.html#spldoc_functions__dlReleaseLock.uint64.uint64">dlReleaseLock(uint64,uint64)</a>.   
</p>

<p class="p"><strong class="ph b">IMPORTANT NOTE:</strong> Once called, this function could spin loop for a very long time (three or four minutes) until it acquires the distributed lock or it times out due to the distributed lock being not yet available.  Another important factor is that once the lock is granted, it is given to you for an infinite period of time. Hence, it is your responsibility to properly release the lock at the end of your task. There is no external mechanism to take the lock back from you in case your code crashes after acquiring the lock. An alternative overloaded function is available that allows you to specify a maximum time to wait, and also allows lock ownership to expire after a given amount of time.  This alternative function is also called <a class="xref" href="fc$com.ibm.streamsx.lock.distributed.html#spldoc_functions__dlAcquireLock.uint64.float64.float64.uint64">dlAcquireLock</a>.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">lock</tt></dt>

             <dd class="dd">

<p class="p">the id of the lock to acquire. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">a mutable variable to receive a non-zero error code in the event of a problem acquiring the lock.  Will be set to '0' on success. 
</p>

<div class="p">
<pre class="pre codeblock">
mutable uint64 lk = 0ul;
mutable uint64 err = 0ul;
lk = dlCreateOrGetLock("My Sentinel Lock1", err);
//do error checking

dlAcquireLock(lk, err);
if (err == 0ul) {
   printStringLn("We acquired the lock My Sentinel Lock1 lk=" + (rstring)lk);
   //perform operation
	  
	//call  dlReleaseLock once done
} else {
   printStringLn("Failed to acquire the lock My Sentinel Lock1 lk=" + (rstring)lk + 
      " rc = " + (rstring)dlGetLastDistributedLockErrorCode() + 
      ", msg = " + dlGetLastDistributedLockErrorString());
   // It is advisable to return from here since the lock is not granted.
   return;
}
</pre>


</div>

             </dd>

           
         </dl>

       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlCreateOrGetLock.rstring.uint64"><tt class="ph tt">      public stateful uint64 dlCreateOrGetLock(rstring name, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p">Create a new distributed lock with a given name or get it if it already exists.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">name</tt></dt>

             <dd class="dd">

<p class="p">the name of the lock to create or retrieve 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">a mutable variable that will retain the error code in event of a problem. On failure, <strong class="ph b">err</strong> is assigned a non-zero value.   
</p>

             </dd>

           
         </dl>

       </dd>

     
     
       <dt class="dt dlterm">Returns</dt>

       <dd class="dd">

<p class="p">0 on error, or the id of the lock otherwise. This id can then be used as a parameter to other lock related functions.  
</p>

<div class="p">
<pre class="pre codeblock">
		mutable uint64 lock_id = 0ul;
		mutable uint64 err = 0ul;
		lock_id = dlCreateOrGetLock("My Sentinel Lock1", err);
    	if (err != 0ul) {
		   printStringLn("Error in creating My Sentinel Lock1. rc = " + 
		   (rstring)dlGetLastDistributedLockErrorCode() + ", msg = " + dlGetLastDistributedLockErrorString());
		} else {
		   printStringLn("My Sentinel Lock1 was created with an id of " + (rstring)lock_id);
		}
</pre>


</div>
       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlGetLastDistributedLockErrorCode"><tt class="ph tt">      public stateful uint64 dlGetLastDistributedLockErrorCode()      </tt>   </dt>

   <dd class="dd">
<p class="p">Get the error code of the last DL error
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Returns</dt>

       <dd class="dd">

<p class="p">the error code for the most recently executed operation, or '0' if no error occurred.       .
</p>
       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlGetLastDistributedLockErrorString"><tt class="ph tt">      public stateful rstring dlGetLastDistributedLockErrorString()      </tt>   </dt>

   <dd class="dd">
<p class="p">Get the description of the error that occurred on the most recently executed operation in the DL API, if any.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Returns</dt>

       <dd class="dd">

<p class="p">a message describing the error that occurred, or the empty string if the last DL operation was successful.
</p>
       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlGetPidForLock.rstring.uint64"><tt class="ph tt">      public stateful uint32 dlGetPidForLock(rstring name, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p">Get the process id that is currently holding a given lock.  This function can be used for test, diagnostic or informational purposes.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">name</tt></dt>

             <dd class="dd">

<p class="p">the name of the distributed lock in question. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">stores the error code if an error occurs, or '0' otherwise. 
</p>

             </dd>

           
         </dl>

       </dd>

     
     
       <dt class="dt dlterm">Returns</dt>

       <dd class="dd">

<p class="p">the id of the Linux process id of the processing element (PE) that currently owns the lock, or '0' if no one owns the lock.  
</p>

<div class="p">
<pre class="pre codeblock">
	mutable uint32 pid = dlGetPidForLock("file_lock", err);
	if (err != 0ul) {
		rstring msg = dlGetLastDistributedLockErrorString();
		uint64 rc = dlGetLastDistributedLockErrorCode();
		printStringLn("Error in dlGetPidForLock(file_lock)  rc = " + (rstring)(rc) + ", msg =" + msg );
	} else {
		printStringLn("Before lock acquisition: pid owning the file_lock = " + (rstring)pid);
	}
</pre>


</div>
       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlReleaseLock.uint64.uint64"><tt class="ph tt">      public stateful void dlReleaseLock(uint64 lock, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p">Release the given distributed lock id.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">lock</tt></dt>

             <dd class="dd">

<p class="p">the id of the lock to release.  The specified lock will be made available for other callers to acquire. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">a mutable variable to receive a non-zero error code in the event of a problem releasing the lock.  Will be set to '0' on success.  
</p>

             </dd>

           
         </dl>

       </dd>

     
</dl>

   </dd>

 
 
   <dt class="dt dlterm splpart" id="spldoc_functions__dlRemoveLock.uint64.uint64"><tt class="ph tt">      public stateful boolean dlRemoveLock(uint64 lock, mutable uint64 err)      </tt>   </dt>

   <dd class="dd">
<p class="p">Remove the distributed lock with the given id.  <strong class="ph b">NOTE</strong>:  Since the whole purpose of distributed locks is to ensure operations are performed safely on shared resources by multiple unrelated application components, do not remove distributed locks abruptly unless you are very clear about what you are doing.  Do it only when you are sure that no one is using the lock at the time of removing it.
</p>

   <dl class="dl">
     <dt class="dt dlterm"/>
<dd class="dd"/>

     
       <dt class="dt dlterm">Parameters</dt>

       <dd class="dd">
         <dl class="dl" compact="compact">
           
             <dt class="dt dlterm"><tt class="ph tt">lock</tt></dt>

             <dd class="dd">

<p class="p">the id of the lock to remove. 
</p>

             </dd>

           
           
             <dt class="dt dlterm"><tt class="ph tt">err</tt></dt>

             <dd class="dd">

<p class="p">a mutable variable to receive the error code. 
</p>

             </dd>

           
         </dl>

       </dd>

     
     
       <dt class="dt dlterm">Returns</dt>

       <dd class="dd">

<p class="p">'true' on success, 'false' otherwise. In the case of an error, a non-zero value is assigned to the <strong class="ph b">err</strong>  variable.
</p>

<div class="p">  	mutable uint64 lock_id = 0ul;
<pre class="pre codeblock">
mutable uint64 err = 0ul;
lock_id = dlCreateOrGetLock("My Sentinel Lock1", err);
...
err = 0ul;
boolean myResult = dlRemoveLock(lock_id, err);
if (!myResult) { 
           printStringLn("Failed to remove the lock My Sentinel Lock1 lock_id=" +(rstring)lock_id + ", err=" + (rstring)err + ", msg=" + dlGetLastDistributedLockErrorString());
} else {
           printStringLn("We removed the lock My Sentinel Lock1 lock_id =" + (rstring)lock_id);
}
</pre>


</div>
       </dd>

     
</dl>

   </dd>

 
</dl>

</div>

</div>


</body>
</html>